<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAZA - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">ZAZA</div>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="dashboard" id="nav-dashboard">
                        <span>üè†</span>
                        <span>–ì–ª–∞–≤–Ω–∞—è</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="tgbot" id="nav-tgbot">
                        <span>ü§ñ</span>
                        <span>–¢–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç—ã</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="employees" id="nav-employees">
                        <span>üë•</span>
                        <span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="tickets" id="nav-tickets">
                        <span>üéØ</span>
                        <span>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="archive" id="nav-archive">
                        <span>üìã</span>
                        <span>–ê—Ä—Ö–∏–≤ —Ç–∏–∫–µ—Ç–æ–≤</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="chat" id="nav-chat">
                        <span>üí¨</span>
                        <span>–ß–∞—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="notes" id="nav-notes">
                        <span>üìù</span>
                        <span>–ó–∞–º–µ—Ç–∫–∏</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="profile" id="nav-profile">
                        <span>üë§</span>
                        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Header -->
    <header class="header">
        <div class="header-title">
            <h1 id="page-title">–ì–ª–∞–≤–Ω–∞—è</h1>
        </div>
        
        <div class="header-right">
            <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
            <div class="user-menu">
                <button class="user-btn" id="profileBtn">
                    <span class="user-avatar">üë§</span>
                    <span id="username">Admin</span>
                </button>
            </div>
            <button class="btn btn-danger" id="logoutBtn">
                –í—ã–π—Ç–∏
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ -->
    </main>

    <!-- –û–±—â–∏–π JavaScript -->
    <script src="/static/auth.js"></script>
    <script src="/static/base.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!checkAuth()) {
                return;
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupNavigation();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—à–±–æ—Ä–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            loadSection('dashboard');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ —Ö–µ–¥–µ—Ä–µ
            setupHeaderButtons();
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-section]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const section = this.getAttribute('data-section');
                    loadSection(section);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    updateActiveNav(section);
                });
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateActiveNav(section) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ç–µ–∫—É—â–µ–π
            const activeLink = document.getElementById(`nav-${section}`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ä–∞–∑–¥–µ–ª–∞
        async function loadSection(section) {
            const mainContent = document.getElementById('mainContent');
            const pageTitle = document.getElementById('page-title');
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                mainContent.innerHTML = '<div style="text-align: center; padding: 50px;"><div>–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞—Ç—å
                let contentFile = '';
                let pageClass = '';
                let title = '';
                
                switch(section) {
                    case 'dashboard':
                        contentFile = 'dashboard-content.html';
                        pageClass = 'page-dashboard';
                        title = '–ì–ª–∞–≤–Ω–∞—è';
                        break;
                    case 'tgbot':
                        contentFile = 'tgbot-content.html';
                        pageClass = 'page-tgbot';
                        title = '–¢–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç—ã';
                        break;
                    case 'employees':
                        contentFile = 'employees-content.html';
                        pageClass = 'page-employees';
                        title = '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏';
                        break;
                    case 'tickets':
                        contentFile = 'tickets-content.html';
                        pageClass = 'page-tickets';
                        title = '–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã';
                        break;
                    case 'archive':
                        contentFile = 'archive-content.html';
                        pageClass = 'page-archive';
                        title = '–ê—Ä—Ö–∏–≤ —Ç–∏–∫–µ—Ç–æ–≤';
                        break;
                    case 'profile':
                        contentFile = 'profile-content.html';
                        pageClass = 'page-profile';
                        title = '–ü—Ä–æ—Ñ–∏–ª—å';
                        break;
                    default:
                        throw new Error(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–∑–¥–µ–ª: ${section}`);
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                const response = await fetch(`/static/${contentFile}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const html = await response.text();
                mainContent.innerHTML = html;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å body –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                document.body.className = pageClass;
                pageTitle.textContent = title;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º JS –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                await loadSectionScript(section);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–∑–¥–µ–ª–∞:', error);
                mainContent.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #ef4444;">
                        <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–∑–¥–µ–ª "${section}"</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ JS —Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞
        async function loadSectionScript(section) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∫—Ä–∏–ø—Ç
            const existingScript = document.getElementById('section-script');
            if (existingScript) {
                existingScript.remove();
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–µ–Ω –ª–∏ JS –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞
            const scriptMap = {
                'dashboard': 'dashboard.js',
                'tgbot': 'tgbot.js'
            };

            if (scriptMap[section]) {
                const script = document.createElement('script');
                script.id = 'section-script';
                script.src = `/static/${scriptMap[section]}`;
                
                return new Promise((resolve, reject) => {
                    script.onload = () => {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–¥–µ–ª –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                        const initFunctionName = `init${section.charAt(0).toUpperCase() + section.slice(1)}`;
                        if (window[initFunctionName]) {
                            window[initFunctionName]();
                        }
                        resolve();
                    };
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ —Ö–µ–¥–µ—Ä–µ
        function setupHeaderButtons() {
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            const profileBtn = document.getElementById('profileBtn');
            if (profileBtn) {
                profileBtn.addEventListener('click', function() {
                    loadSection('profile');
                    updateActiveNav('profile');
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    localStorage.removeItem('token');
                    window.location.href = '/static/login.html';
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã (–µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥–∏–∫–∞)
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    document.body.classList.toggle('dark-theme');
                    const isDark = document.body.classList.contains('dark-theme');
                    this.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    themeToggle.textContent = '‚òÄÔ∏è';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø—Ä–æ—Ñ–∏–ª—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º)
        function showProfile() {
            loadSection('profile');
            updateActiveNav('profile');
        }
    </script>
</body>
</html>