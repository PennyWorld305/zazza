<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ - ZAZA Admin</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            color: white;
        }

        .role-admin {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .role-operator {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .role-courier {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .status-btn {
            padding: 4px 12px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-btn.active {
            background-color: #28a745;
            color: white;
        }

        .status-btn.inactive {
            background-color: #dc3545;
            color: white;
        }

        .status-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-sm.btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-sm.btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-sm.btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-sm.btn-success {
            background: #28a745;
            color: white;
        }

        .btn-sm:hover {
            transform: translateY(-1px);
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            width: 500px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 16px;
            color: #666;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #666;
            background: #f0f0f0;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .modal-btn-cancel {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #dee2e6;
        }

        .modal-btn-cancel:hover {
            background: #e9ecef;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-confirm:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body class="page-employees">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">ZAZA</div>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="dashboard" id="nav-dashboard">
                        <span>üè†</span>
                        <span>–ì–ª–∞–≤–Ω–∞—è</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="tgbot" id="nav-tgbot">
                        <span>ü§ñ</span>
                        <span>–¢–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç—ã</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="employees" id="nav-employees">
                        <span>üë•</span>
                        <span>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/static/clients.html" class="nav-link">
                        <span>üë§</span>
                        <span>–ö–ª–∏–µ–Ω—Ç—ã</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="tickets" id="nav-tickets">
                        <span>üéØ</span>
                        <span>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–∫–µ—Ç—ã</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="archive" id="nav-archive">
                        <span>üìã</span>
                        <span>–ê—Ä—Ö–∏–≤ —Ç–∏–∫–µ—Ç–æ–≤</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="chat" id="nav-chat">
                        <span>üí¨</span>
                        <span>–ß–∞—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="notes" id="nav-notes">
                        <span>üìù</span>
                        <span>–ó–∞–º–µ—Ç–∫–∏</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <div class="main-wrapper">
        <header class="header">
            <div class="header-left">
                <h1 id="page-title">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>
            </div>
            
            <div class="header-right">
                <button class="theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
                <div class="user-menu">
                    <button class="user-btn" id="profileBtn">
                        <span class="user-avatar">üë§</span>
                        <span id="username">Admin</span>
                    </button>
                </div>
                <button class="btn btn-danger" id="logoutBtn">
                    –í—ã–π—Ç–∏
                </button>
            </div>
        </header>

        <main class="main-content" id="mainContent">
            <div class="container">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="openAddModal()">
                            <span>+</span> –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                        </button>
                    </div>
                    <div class="card-body">

                        <div class="table-container">
                            <table class="data-table" id="employeesTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–õ–æ–≥–∏–Ω</th>
                                        <th>–ò–º—è</th>
                                        <th>–†–æ–ª—å</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–°–æ–∑–¥–∞–Ω</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesTableBody">
                                    <tr>
                                        <td colspan="7" class="loading-row">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div class="modal-overlay" id="employeeModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="employeeForm">
                <div class="form-group" id="loginGroup">
                    <label for="employeeLogin">–õ–æ–≥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
                    <input type="text" id="employeeLogin" name="login" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                
                <div class="form-group">
                    <label for="employeeName">–ü–æ–ª–Ω–æ–µ –∏–º—è:</label>
                    <input type="text" id="employeeName" name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é">
                </div>
                
                <div class="form-group" id="passwordGroup">
                    <label for="employeePassword">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="employeePassword" name="password" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div class="form-group">
                    <label for="employeeRole">–†–æ–ª—å:</label>
                    <select id="employeeRole" name="role" required>
                        <option value="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
                        <option value="courier">–ö—É—Ä—å–µ—Ä</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn modal-btn-cancel" onclick="closeModal()">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="modal-btn modal-btn-confirm" id="submitButton">
                        <span id="submitButtonText">–°–æ–∑–¥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –û–±—â–∏–π JavaScript -->
    <script src="/static/base.js"></script>
    <script>
        let currentEmployees = [];
        let isEditMode = false;
        let editEmployeeId = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadEmployees();
            setupEventListeners();
            setupNavigation();
            setupHeaderButtons();
            loadUserProfile();
        });

        async function loadEmployees() {
            try {
                const token = getToken(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ base.js
                
                if (!token) {
                    console.error('–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                    document.getElementById('employeesContent').innerHTML = 
                        '<div style="text-align: center; color: #d32f2f; padding: 20px;">–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. <a href="/static/login.html">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a></div>';
                    return;
                }

                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...');
                const response = await fetch('http://localhost:8000/api/employees', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);

                if (response.ok) {
                    const data = await response.json();
                    console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', data);
                    currentEmployees = data.employees;
                    displayEmployees(data.employees);
                } else {
                    const errorText = await response.text();
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', response.status, errorText);
                    document.getElementById('employeesContent').innerHTML = 
                        `<div style="text-align: center; color: #d32f2f; padding: 20px;">–û—à–∏–±–∫–∞ ${response.status}: ${errorText}</div>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', error);
                document.getElementById('employeesContent').innerHTML = 
                    '<div style="text-align: center; color: #d32f2f; padding: 20px;">–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: ' + error.message + '</div>';
            }
        }

        function displayEmployees(employees) {
            const tableBody = document.getElementById('employeesTableBody');
            
            if (employees.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #999; padding: 20px;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</td></tr>';
                return;
            }

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
            tableBody.innerHTML = employees.map(employee => `
                <tr>
                    <td>${employee.id}</td>
                    <td>${employee.login}</td>
                    <td>${employee.name}</td>
                    <td>
                        <span class="status-badge" style="background-color: ${getRoleColor(employee.role)}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px;">
                            ${getRoleName(employee.role)}
                        </span>
                    </td>
                    <td>
                        <button class="status-btn ${employee.is_active ? 'active' : 'inactive'}" 
                                onclick="toggleEmployeeStatus(${employee.id}, ${employee.is_active})"
                                style="padding: 4px 12px; border: none; border-radius: 20px; font-size: 12px; cursor: pointer; background: ${employee.is_active ? '#28a745' : '#dc3545'}; color: white;">
                            ${employee.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                        </button>
                    </td>
                    <td>
                        ${employee.created_at 
                            ? new Date(employee.created_at).toLocaleDateString('ru-RU')
                            : '-'
                        }
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editEmployee(${employee.id})" style="margin-right: 5px; padding: 4px 8px; font-size: 12px;">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        ${employee.role !== 'admin' ? `
                            <button class="btn btn-sm ${employee.is_active ? 'btn-warning' : 'btn-success'}" 
                                    onclick="toggleEmployeeStatus(${employee.id}, ${employee.is_active})" 
                                    style="margin-right: 5px; padding: 4px 8px; font-size: 12px;">
                                ${employee.is_active ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})" style="padding: 4px 8px; font-size: 12px;">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function getRoleName(role) {
            const names = {
                'admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                'operator': '–û–ø–µ—Ä–∞—Ç–æ—Ä',
                'courier': '–ö—É—Ä—å–µ—Ä'
            };
            return names[role] || role;
        }

        function getRoleColor(role) {
            const colors = {
                'admin': '#6f42c1',
                'operator': '#fd7e14',
                'courier': '#20c997'
            };
            return colors[role] || '#6c757d';
        }

        function setupEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('employeeForm').addEventListener('submit', handleFormSubmit);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ overlay
            document.getElementById('employeeModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('employeeModal').style.display === 'flex') {
                    closeModal();
                }
            });
        }

        function openAddModal() {
            isEditMode = false;
            editEmployeeId = null;
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
            document.getElementById('submitButtonText').textContent = '–°–æ–∑–¥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
            document.getElementById('loginGroup').style.display = 'block';
            document.getElementById('passwordGroup').style.display = 'block';
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('employeeForm').reset();
            document.getElementById('employeeRole').value = 'operator';
            
            // –î–µ–ª–∞–µ–º –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
            document.getElementById('employeePassword').required = true;
            document.getElementById('employeePassword').placeholder = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('employeeModal').style.display = 'flex';
        }

        function editEmployee(employeeId) {
            const employee = currentEmployees.find(e => e.id === employeeId);
            if (!employee) return;

            isEditMode = true;
            editEmployeeId = employeeId;
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
            document.getElementById('submitButtonText').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
            document.getElementById('loginGroup').style.display = 'block';
            document.getElementById('passwordGroup').style.display = 'block';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
            document.getElementById('employeeLogin').value = employee.login;
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeeRole').value = employee.role;
            
            // –î–µ–ª–∞–µ–º –ø–∞—Ä–æ–ª—å –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
            document.getElementById('employeePassword').required = false;
            document.getElementById('employeePassword').placeholder = '–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª—å';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('employeeModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('employeeModal').style.display = 'none';
            document.getElementById('employeeForm').reset();
            isEditMode = false;
            editEmployeeId = null;
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const token = getToken();

            try {
                let url, method, body;

                if (isEditMode) {
                    // –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    const editData = {
                        login: formData.get('login'),
                        name: formData.get('name'),
                        role: formData.get('role'),
                        is_active: true
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –∑–∞–ø–æ–ª–Ω–µ–Ω
                    const password = formData.get('password');
                    if (password && password.trim()) {
                        editData.password = password;
                    }
                    
                    url = `http://localhost:8000/api/employees/${editEmployeeId}`;
                    method = 'PUT';
                    body = JSON.stringify(editData);
                } else {
                    url = 'http://localhost:8000/api/employees';
                    method = 'POST';
                    body = JSON.stringify({
                        login: formData.get('login'),
                        name: formData.get('name'),
                        password: formData.get('password'),
                        role: formData.get('role')
                    });
                }

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body
                });

                if (response.ok) {
                    await loadEmployees();
                    closeModal();
                    showNotification(isEditMode ? '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω', 'success');
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
            }
        }

        async function deleteEmployee(employeeId) {
            const employee = currentEmployees.find(e => e.id === employeeId);
            if (!employee) return;

            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ "${employee.name}"?`)) {
                return;
            }

            try {
                const token = getToken();
                const response = await fetch(`http://localhost:8000/api/employees/${employeeId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    await loadEmployees();
                    showNotification('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª–µ–Ω', 'success');
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
            }
        }

        async function toggleEmployeeStatus(employeeId, currentStatus) {
            const employee = currentEmployees.find(e => e.id === employeeId);
            if (!employee) return;

            try {
                const token = getToken();
                const response = await fetch(`http://localhost:8000/api/employees/${employeeId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name: employee.name,
                        role: employee.role,
                        is_active: !currentStatus
                    })
                });

                if (response.ok) {
                    await loadEmployees();
                    showNotification('–°—Ç–∞—Ç—É—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                } else {
                    const errorData = await response.json();
                    showNotification(errorData.detail || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
            }
        }

        function showNotification(message, type = 'info') {
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-weight: 500;
                z-index: 2000;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-section]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const section = this.getAttribute('data-section');
                    navigateToPage(section);
                });
            });
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function navigateToPage(section) {
            let url = '';
            switch(section) {
                case 'dashboard':
                    url = '/static/dashboard.html';
                    break;
                case 'tgbot':
                    url = '/static/tgbot.html';
                    break;
                case 'tickets':
                    url = '/static/tickets.html';
                    break;
                case 'archive':
                    url = '/static/archive.html';
                    break;
                case 'employees':
                    // –û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    return;
                case 'chat':
                    url = '/static/chat.html';
                    break;
                case 'notes':
                    url = '/static/notes.html';
                    break;
            }
            
            if (url) {
                window.location.href = url;
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤ —Ö–µ–¥–µ—Ä–µ
        function setupHeaderButtons() {
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            const profileBtn = document.getElementById('profileBtn');
            if (profileBtn) {
                profileBtn.addEventListener('click', function() {
                    window.location.href = '/static/profile.html';
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    localStorage.removeItem('access_token');
                    window.location.href = '/static/login.html';
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserProfile() {
            try {
                const token = getToken();
                const response = await fetch('http://localhost:8000/api/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const profile = await response.json();
                    const usernameElement = document.getElementById('username');
                    if (usernameElement) {
                        usernameElement.textContent = profile.display_name || profile.username;
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const dashboardManager = new BaseDashboardManager();
    </script>
</body>
</html>